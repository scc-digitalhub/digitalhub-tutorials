# ETL (Extract transform load)

The scenario depict how to collect some data regarding traffic, analyze and transform it, then expose the resulting dataset. The 's1-etl' folder contains
a jypter notebook and a digitalhub project. 

- Jypter notebook 
	- Import the Jupyter notebook for each scenario located inside project folder in the 'Coder' instance and execute it step by step.

- Project
	
   1. Import the project inside the 'Coder' instance using the yaml file.
	```
 	import digitalhub as dh
 	proj = dh.import_project('project-etl-ci.yml')
	```

   2.  View the project details such as pipeline name.
    ```
    print(proj)
   ```
   ```
   {'kind': 'project', 'metadata': {'project': 'project-etl-ci', 'name': 'project-etl-ci', 'created': '2024-10-24T11:20:17.542Z', 'updated': '2024-10-24T11:28:49.778Z'}, 'spec': {'context': './', 'functions': [{'id': 'cad09f32-6468-480a-b3ef-a30379fecd60', 'key': 'store://project-etl-ci/function/python/download-data:cad09f32-6468-480a-b3ef-a30379fecd60', 'kind': 'python', 'metadata': {'created': '2024-10-24T11:22:04.66Z', 'name': 'download-data', 'project': 'project-etl-ci', 'updated': '2024-10-24T11:22:04.66Z', 'ref': 'function-download-data-cad09f32-6468-480a-b3ef-a30379fecd60.yml'}, 'name': 'download-data', 'project': 'project-etl-ci'}, {'id': '9f5de914-72fe-4ade-9fdf-8007c4cd6350', 'key': 'store://project-etl-ci/function/python/process-spire:9f5de914-72fe-4ade-9fdf-8007c4cd6350', 'kind': 'python', 'metadata': {'created': '2024-10-24T11:24:23.608Z', 'name': 'process-spire', 'project': 'project-etl-ci', 'updated': '2024-10-24T11:24:23.608Z', 'ref': 'function-process-spire-9f5de914-72fe-4ade-9fdf-8007c4cd6350.yml'}, 'name': 'process-spire', 'project': 'project-etl-ci'}, {'id': '8d736080-3f52-4de5-b8be-158b9b7cec07', 'key': 'store://project-etl-ci/function/python/process-measures:8d736080-3f52-4de5-b8be-158b9b7cec07', 'kind': 'python', 'metadata': {'created': '2024-10-24T11:25:34.654Z', 'name': 'process-measures', 'project': 'project-etl-ci', 'updated': '2024-10-24T11:25:34.654Z', 'ref': 'function-process-measures-8d736080-3f52-4de5-b8be-158b9b7cec07.yml'}, 'name': 'process-measures', 'project': 'project-etl-ci'}, {'id': '02125fed-2efb-48ea-a688-f90d6d6aab21', 'key': 'store://project-etl-ci/function/python/api:02125fed-2efb-48ea-a688-f90d6d6aab21', 'kind': 'python', 'metadata': {'created': '2024-10-24T11:26:24.489Z', 'name': 'api', 'project': 'project-etl-ci', 'updated': '2024-10-24T11:26:24.489Z', 'ref': 'function-api-02125fed-2efb-48ea-a688-f90d6d6aab21.yml'}, 'name': 'api', 'project': 'project-etl-ci'}], 'artifacts': [], 'workflows': [{'id': '051163dd-cbe0-4c50-8ea2-84fd295918c9', 'key': 'store://project-etl-ci/workflow/kfp/pipeline:051163dd-cbe0-4c50-8ea2-84fd295918c9', 'kind': 'kfp', 'metadata': {'created': '2024-10-24T11:26:10.234Z', 'name': 'pipeline', 'project': 'project-etl-ci', 'updated': '2024-10-24T11:26:10.234Z', 'ref': 'workflow-pipeline-051163dd-cbe0-4c50-8ea2-84fd295918c9.yml'}, 'name': 'pipeline', 'project': 'project-etl-ci'}], 'dataitems': [], 'models': []}, 'status': {'state': 'CREATED'}, 'id': 'project-etl-ci', 'name': 'project-etl-ci', 'key': 'store://project-etl-ci'}
   ```
   
   3. Create the input parameter from url
    ```
    URL = "https://opendata.comune.bologna.it/api/explore/v2.1/catalog/datasets/rilevazione-flusso-veicoli-tramite-spire-anno-2023/exports/csv?lang=it&timezone=Europe%2FRome&use_labels=true&delimiter=%3B"
	di= proj.new_dataitem(name="url_data_item",kind="table",path=URL)
	di.key
    ```
	```
	'store://project-etl-ci/dataitem/table/url_data_item:ed2c0631-8112-4fe1-b5f6-6a0d56f5872e'
	```
   
   4. Run the pipeline
    ```
    workflow_run = proj.run('pipeline', parameters={"url": di.key})
    ```
    We can now explore the results of the function. We can fetch the list of dataitems using digithub sdk.
    ```
    data_items = dh.list_dataitems(project='project-etl-ci')
    ```
    ```
    print(len(data_items))
    ```
    As the result of scenario 4 data items are created in the core project. One can use the 'Core' instance to view them in the project console.
    ```
    print(data_items)
    ```
    ```
    [{'kind': 'table', 'metadata': {'project': 'project-etl-ci', 'name': 'dataset-measures', 'version': '0f11aaf1-a446-467f-a488-2867352205b6', 'created': '2024-10-28T08:23:53.138Z', 'updated': '2024-10-28T08:23:53.138Z', 'created_by': 'khurshid@fbk.eu', 'updated_by': 'khurshid@fbk.eu', 'embedded': False}, 'spec': {'path': 's3://datalake/project-etl-ci/dataitem/dataset-measures/0f11aaf1-a446-467f-a488-2867352205b6/dataset-measures.parquet', 'schema': {'fields': [{'name': 'time', 'type': 'string'}, {'name': 'codice spira', 'type': 'string'}, {'name': 'value', 'type': 'integer'}]}}, 'status': {'state': 'CREATED', 'files': [{'path': 'dataset-measures.parquet', 'name': 'dataset-measures.parquet', 'content_type': 'binary/octet-stream', 'size': 20906924, 'hash': 'md5:c9638b553b6465a0776edf3bfd161bc7', 'last_modified': '2024-10-28T08:23:53+00:00'}], 'preview': {'cols': [{'name': 'time', 'value': ['2023-03-25 00:00', '2023-03-25 00:00', '2023-03-25 00:00', '2023-03-25 00:00', '2023-03-25 00:00', '2023-03-25 00:00', '2023-03-25 00:00', '2023-03-25 00:00', '2023-03-25 00:00', '2023-03-25 00:00']}, {'name': 'codice spira', 'value': ['0.127 3.89 6 1', '0.127 3.89 8 1', '0.127 3.90 6 1', '0.127 3.93 4 1', '0.127 3.93 6 1', '0.127 3.93 8 1', '0.127 3.95 2 1', '0.127 3.95 6 1', '0.127 4.4 3 1', '0.127 4.5 4 1']}, {'name': 'value', 'value': [97, 52, 167, 5, 234, 29, 28, 36, 30, 138]}], 'rows': 7513608}}, 'user': 'khurshid@fbk.eu', 'project': 'project-etl-ci', 'name': 'dataset-measures', 'id': '0f11aaf1-a446-467f-a488-2867352205b6', 'key': 'store://project-etl-ci/dataitem/table/dataset-measures:0f11aaf1-a446-467f-a488-2867352205b6'}, {'kind': 'table', 'metadata': {'project': 'project-etl-ci', 'name': 'dataset-spire', 'version': 'ce524421-69f6-4bc4-b3d8-cfa1fcbe5c91', 'created': '2024-10-28T08:23:50.852Z', 'updated': '2024-10-28T08:23:50.852Z', 'created_by': 'khurshid@fbk.eu', 'updated_by': 'khurshid@fbk.eu', 'embedded': False}, 'spec': {'path': 's3://datalake/project-etl-ci/dataitem/dataset-spire/ce524421-69f6-4bc4-b3d8-cfa1fcbe5c91/dataset-spire.parquet', 'schema': {'fields': [{'name': 'codice spira', 'type': 'string'}, {'name': 'longitudine', 'type': 'number'}, {'name': 'latitudine', 'type': 'number'}, {'name': 'Livello', 'type': 'integer'}, {'name': 'tipologia', 'type': 'string'}, {'name': 'codice', 'type': 'number'}, {'name': 'codice arco', 'type': 'integer'}, {'name': 'codice via', 'type': 'integer'}, {'name': 'Nome via', 'type': 'string'}, {'name': 'stato', 'type': 'string'}, {'name': 'direzione', 'type': 'string'}, {'name': 'angolo', 'type': 'number'}, {'name': 'geopoint', 'type': 'string'}]}}, 'status': {'state': 'CREATED', 'files': [{'path': 'dataset-spire.parquet', 'name': 'dataset-spire.parquet', 'content_type': 'binary/octet-stream', 'size': 73795, 'hash': 'md5:81915c513fa70a71d733f468bcde1921', 'last_modified': '2024-10-28T08:23:50+00:00'}], 'preview': {'cols': [{'name': 'codice spira', 'value': ['0.127 1.1 6 1', '0.127 1.12 8 1', '0.127 1.13 6 1', '0.127 1.14 4 1', '0.127 1.15 2 1', '0.127 1.15 6 1', '0.127 1.16 2 1', '0.127 1.16 8 1', '0.127 1.17 4 1', '0.127 1.18 1 1']}, {'name': 'longitudine', 'value': [11.3541657967424, 11.338970003537, 11.3464200565732, 11.3398356513878, 11.3433581064329, 11.3434427397635, 11.3519809631422, 11.3520841867509, 11.3509026754331, 11.338564528943]}, {'name': 'latitudine', 'value': [44.4985349106485, 44.4952505129043, 44.4916483847646, 44.4901162203284, 44.4895074220971, 44.4900271601578, 44.4941035248986, 44.4943294432991, 44.4923692879684, 44.4992226472054]}, {'name': 'Livello', 'value': [1, 1, 1, 1, 1, 1, 1, 1, 1, 1]}, {'name': 'tipologia', 'value': ['spira', 'spira', 'spira', 'spira', 'spira', 'spira', 'spira', 'spira', 'spira', 'spira']}, {'name': 'codice', 'value': [498.0, 1045.0, 130.0, 521.0, 132.0, 133.0, 1073.0, 313.0, 310.0, 947.0]}, {'name': 'codice arco', 'value': [3312, 1016, 1169, 1050, 1064, 1059, 1405, 1743, 1187, 2904]}, {'name': 'codice via', 'value': [19900, 5900, 14700, 59900, 25800, 25800, 1400, 45400, 9600, 35200]}, {'name': 'Nome via', 'value': ['VIA G.BATTISTA DE ROLANDIS', 'VIA CESARE BATTISTI', 'VIA CASTIGLIONE', 'VIA URBANA', 'VIA GARIBALDI', 'VIA GARIBALDI', 'PIAZZA ALDROVANDI', 'VIA GIUSEPPE PETRONI', 'VIA BORGONUOVO', 'VIA GUGLIELMO MARCONI']}, {'name': 'stato', 'value': ['A', 'A', 'A', 'A', 'A', 'A', 'A', 'A', 'A', 'A']}, {'name': 'direzione', 'value': ['N', 'N', 'S', 'E', 'N', 'S', 'NO', 'S', 'NE', 'S']}, {'name': 'angolo', 'value': [342.0, 350.0, 198.0, 264.0, 347.0, 168.0, 352.0, 193.0, 333.0, 163.0]}, {'name': 'geopoint', 'value': ['44.4985349106485, 11.3541657967424', '44.4952505129043, 11.338970003537', '44.4916483847646, 11.3464200565732', '44.4901162203284, 11.3398356513878', '44.4895074220971, 11.3433581064329', '44.4900271601578, 11.3434427397635', '44.4941035248986, 11.3519809631422', '44.4943294432991, 11.3520841867509', '44.4923692879684, 11.3509026754331', '44.4992226472054, 11.338564528943']}], 'rows': 905}}, 'user': 'khurshid@fbk.eu', 'project': 'project-etl-ci', 'name': 'dataset-spire', 'id': 'ce524421-69f6-4bc4-b3d8-cfa1fcbe5c91', 'key': 'store://project-etl-ci/dataitem/table/dataset-spire:ce524421-69f6-4bc4-b3d8-cfa1fcbe5c91'}, {'kind': 'table', 'metadata': {'project': 'project-etl-ci', 'name': 'dataset', 'version': 'a72fa037-61a2-46c4-bb3b-e946672589cb', 'created': '2024-10-28T08:22:17.777Z', 'updated': '2024-10-28T08:22:17.777Z', 'created_by': 'khurshid@fbk.eu', 'updated_by': 'khurshid@fbk.eu', 'embedded': False}, 'spec': {'path': 's3://datalake/project-etl-ci/dataitem/dataset/a72fa037-61a2-46c4-bb3b-e946672589cb/dataset.parquet', 'schema': {'fields': [{'name': 'data', 'type': 'string'}, {'name': 'codice spira', 'type': 'string'}, {'name': '00:00-01:00', 'type': 'integer'}, {'name': '01:00-02:00', 'type': 'integer'}, {'name': '02:00-03:00', 'type': 'integer'}, {'name': '03:00-04:00', 'type': 'integer'}, {'name': '04:00-05:00', 'type': 'integer'}, {'name': '05:00-06:00', 'type': 'integer'}, {'name': '06:00-07:00', 'type': 'integer'}, {'name': '07:00-08:00', 'type': 'integer'}, {'name': '08:00-09:00', 'type': 'integer'}, {'name': '09:00-10:00', 'type': 'integer'}, {'name': '10:00-11:00', 'type': 'integer'}, {'name': '11:00-12:00', 'type': 'integer'}, {'name': '12:00-13:00', 'type': 'integer'}, {'name': '13:00-14:00', 'type': 'integer'}, {'name': '14:00-15:00', 'type': 'integer'}, {'name': '15:00-16:00', 'type': 'integer'}, {'name': '16:00-17:00', 'type': 'integer'}, {'name': '17:00-18:00', 'type': 'integer'}, {'name': '18:00-19:00', 'type': 'integer'}, {'name': '19:00-20:00', 'type': 'integer'}, {'name': '20:00-21:00', 'type': 'integer'}, {'name': '21:00-22:00', 'type': 'integer'}, {'name': '22:00-23:00', 'type': 'integer'}, {'name': '23:00-24:00', 'type': 'integer'}, {'name': 'id_uni', 'type': 'integer'}, {'name': 'Livello', 'type': 'integer'}, {'name': 'tipologia', 'type': 'string'}, {'name': 'codice', 'type': 'number'}, {'name': 'codice arco', 'type': 'integer'}, {'name': 'codice via', 'type': 'integer'}, {'name': 'Nome via', 'type': 'string'}, {'name': 'Nodo da', 'type': 'integer'}, {'name': 'Nodo a', 'type': 'integer'}, {'name': 'ordinanza', 'type': 'string'}, {'name': 'stato', 'type': 'string'}, {'name': 'codimpsem', 'type': 'integer'}, {'name': 'direzione', 'type': 'string'}, {'name': 'angolo', 'type': 'number'}, {'name': 'longitudine', 'type': 'number'}, {'name': 'latitudine', 'type': 'number'}, {'name': 'geopoint', 'type': 'string'}, {'name': 'ID_univoco_stazione_spira', 'type': 'number'}, {'name': 'giorno settimana', 'type': 'string'}]}}, 'status': {'state': 'CREATED', 'files': [{'path': 'dataset.parquet', 'name': 'dataset.parquet', 'content_type': 'binary/octet-stream', 'size': 16613605, 'hash': 'md5:a8fbe2813c0e478015769dc07ce02af8', 'last_modified': '2024-10-28T08:22:17+00:00'}], 'preview': {'cols': [{'name': 'data', 'value': ['2023-03-25', '2023-03-25', '2023-03-25', '2023-03-25', '2023-03-25', '2023-03-25', '2023-03-25', '2023-03-25', '2023-03-25', '2023-03-25']}, {'name': 'codice spira', 'value': ['0.127 3.89 6 1', '0.127 3.89 8 1', '0.127 3.90 6 1', '0.127 3.93 4 1', '0.127 3.93 6 1', '0.127 3.93 8 1', '0.127 3.95 2 1', '0.127 3.95 6 1', '0.127 4.4 3 1', '0.127 4.5 4 1']}, {'name': '00:00-01:00', 'value': [97, 52, 167, 5, 234, 29, 28, 36, 30, 138]}, {'name': '01:00-02:00', 'value': [55, 25, 94, 3, 136, 20, 19, 29, 17, 111]}, {'name': '02:00-03:00', 'value': [31, 12, 69, 0, 95, 13, 11, 22, 4, 54]}, {'name': '03:00-04:00', 'value': [16, 14, 37, 5, 85, 6, 17, 9, 6, 42]}, {'name': '04:00-05:00', 'value': [15, 5, 42, 5, 55, 6, 9, 12, 8, 24]}, {'name': '05:00-06:00', 'value': [38, 13, 62, 7, 103, 13, 13, 30, 4, 36]}, {'name': '06:00-07:00', 'value': [77, 24, 85, 10, 141, 29, 22, 49, 12, 97]}, {'name': '07:00-08:00', 'value': [194, 69, 151, 26, 287, 106, 67, 134, 34, 220]}, {'name': '08:00-09:00', 'value': [263, 101, 289, 43, 486, 105, 97, 178, 62, 395]}, {'name': '09:00-10:00', 'value': [369, 139, 326, 44, 506, 138, 97, 233, 71, 510]}, {'name': '10:00-11:00', 'value': [441, 140, 405, 51, 719, 122, 132, 261, 82, 575]}, {'name': '11:00-12:00', 'value': [482, 146, 437, 42, 793, 110, 124, 236, 90, 564]}, {'name': '12:00-13:00', 'value': [495, 141, 519, 42, 830, 126, 130, 194, 100, 512]}, {'name': '13:00-14:00', 'value': [394, 145, 463, 38, 734, 86, 106, 122, 62, 424]}, {'name': '14:00-15:00', 'value': [311, 123, 376, 31, 607, 101, 75, 137, 72, 424]}, {'name': '15:00-16:00', 'value': [384, 113, 398, 27, 643, 102, 70, 147, 65, 397]}, {'name': '16:00-17:00', 'value': [373, 118, 431, 32, 738, 102, 98, 153, 44, 407]}, {'name': '17:00-18:00', 'value': [452, 119, 441, 44, 766, 101, 95, 169, 65, 445]}, {'name': '18:00-19:00', 'value': [668, 135, 487, 125, 854, 89, 256, 149, 59, 503]}, {'name': '19:00-20:00', 'value': [535, 138, 451, 90, 667, 84, 152, 110, 83, 535]}, {'name': '20:00-21:00', 'value': [326, 72, 354, 33, 504, 60, 67, 65, 77, 423]}, {'name': '21:00-22:00', 'value': [177, 63, 193, 13, 309, 45, 39, 56, 54, 274]}, {'name': '22:00-23:00', 'value': [162, 68, 193, 15, 295, 46, 37, 62, 30, 220]}, {'name': '23:00-24:00', 'value': [122, 64, 174, 13, 310, 49, 59, 57, 33, 239]}, {'name': 'id_uni', 'value': [410, 408, 856, 419, 420, 418, 866, 865, 58, 54]}, {'name': 'Livello', 'value': [1, 1, 1, 1, 1, 1, 1, 1, 1, 1]}, {'name': 'tipologia', 'value': ['spira', 'spira', 'spira', 'spira', 'spira', 'spira', 'spira', 'spira', 'spira', 'spira']}, {'name': 'codice', 'value': [693.0, 691.0, 1197.0, 703.0, 704.0, 702.0, 1207.0, 1206.0, 305.0, 301.0]}, {'name': 'codice arco', 'value': [3400, 3405, 4799, 10295, 10034, 3511, 3663, 3815, 4444, 1919]}, {'name': 'codice via', 'value': [2100, 7500, 20500, 11050, 21580, 11050, 11050, 11050, 55630, 4000]}, {'name': 'Nome via', 'value': ['VIA ISABELLA ANDREINI', 'VIA FILIPPO BEROALDO', 'VIA SAN DONATO', 'VIA CADRIANO', 'VIALE EUROPA', 'VIA CADRIANO', 'VIA CADRIANO', 'VIA CADRIANO', 'VIA SPARTACO', 'VIA AZZURRA']}, {'name': 'Nodo da', 'value': [10516, 10535, 10991, 17349, 13395, 10614, 10758, 10754, 6584, 6554]}, {'name': 'Nodo a', 'value': [10539, 10539, 10992, 15789, 15789, 15789, 10754, 10984, 6583, 6555]}, {'name': 'ordinanza', 'value': ['4000/343434', '4000/343434', '4000/343434', '4000/343434', '4000/343434', '4000/343434', '4000/343434', '4000/343434', '4000/343434', '4000/343434']}, {'name': 'stato', 'value': ['A', 'A', 'A', 'A', 'A', 'A', 'A', 'A', 'A', 'A']}, {'name': 'codimpsem', 'value': [156, 156, 232, 106, 106, 106, 84, 84, 198, 199]}, {'name': 'direzione', 'value': ['N', 'E', 'NE', 'SE', 'NE', 'N', 'SO', 'NE', 'N', 'N']}, {'name': 'angolo', 'value': [348.0, 242.0, 308.0, 217.0, 321.0, 358.0, 150.0, 323.0, 348.0, 354.0]}, {'name': 'longitudine', 'value': [11.3732419756135, 11.3728670312021, 11.410369186317224, 11.381752851058, 11.3816808772175, 11.3821597954981, 11.384043344665631, 11.384028086390003, 11.3780980583658, 11.3740995757403]}, {'name': 'latitudine', 'value': [44.4995320603747, 44.4998932893995, 44.52403243227343, 44.5181320170998, 44.5176422952597, 44.5176521492238, 44.52906048056146, 44.52896574153405, 44.4927612958129, 44.4931377999186]}, {'name': 'geopoint', 'value': ['44.4995320603747, 11.3732419756135', '44.4998932893995, 11.3728670312021', '44.52403243227343, 11.410369186317224', '44.5181320170998, 11.381752851058', '44.5176422952597, 11.3816808772175', '44.5176521492238, 11.3821597954981', '44.52906048056146, 11.384043344665631', '44.528965741534044, 11.384028086390005', '44.4927612958129, 11.3780980583658', '44.4931377999186, 11.3740995757403']}, {'name': 'ID_univoco_stazione_spira', 'value': [207.0, 208.0, 211.0, 217.0, 218.0, 219.0, 222.0, 224.0, 262.0, 283.0]}, {'name': 'giorno settimana', 'value': ['Sabato', 'Sabato', 'Sabato', 'Sabato', 'Sabato', 'Sabato', 'Sabato', 'Sabato', 'Sabato', 'Sabato']}], 'rows': 313067}}, 'user': 'khurshid@fbk.eu', 'project': 'project-etl-ci', 'name': 'dataset', 'id': 'a72fa037-61a2-46c4-bb3b-e946672589cb', 'key': 'store://project-etl-ci/dataitem/table/dataset:a72fa037-61a2-46c4-bb3b-e946672589cb'}, {'kind': 'table', 'metadata': {'project': 'project-etl-ci', 'name': 'url_data_item', 'version': '45d2444c-afff-49d7-9ebc-55cef3cb72a3', 'created': '2024-10-28T08:19:06.162Z', 'updated': '2024-10-28T08:19:06.162Z', 'created_by': 'khurshid@fbk.eu', 'updated_by': 'khurshid@fbk.eu', 'embedded': False}, 'spec': {'path': 'https://opendata.comune.bologna.it/api/explore/v2.1/catalog/datasets/rilevazione-flusso-veicoli-tramite-spire-anno-2023/exports/csv?lang=it&timezone=Europe%2FRome&use_labels=true&delimiter=%3B'}, 'status': {'state': 'CREATED', 'files': [{'path': 'https://opendata.comune.bologna.it/api/explore/v2.1/catalog/datasets/rilevazione-flusso-veicoli-tramite-spire-anno-2023/exports/csv?lang=it&timezone=Europe%2FRome&use_labels=true&delimiter=%3B', 'name': 'csv?lang=it&timezone=Europe%2FRome&use_labels=true&delimiter=%3B', 'size': -1, 'content_type': 'text/csv;charset=utf-8', 'last_modified': '1969-12-31T23:59:59.999+00:00'}]}, 'user': 'khurshid@fbk.eu', 'project': 'project-etl-ci', 'name': 'url_data_item', 'id': '45d2444c-afff-49d7-9ebc-55cef3cb72a3', 'key': 'store://project-etl-ci/dataitem/table/url_data_item:45d2444c-afff-49d7-9ebc-55cef3cb72a3'}]
    ```
    
    
	
	

	
	


